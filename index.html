<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</title>
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <style>
    body { margin: 0; font-family: Arial; background-color: #f4f4f4; }
    .login-page, .main-page { display: none; height: 100vh; }
    .login-page { display: flex; justify-content: center; align-items: center; background: #222; color: white; }
    .login-box { background: #333; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px #000; }
    .login-box input { width: 100%; margin: 10px 0; padding: 10px; }
    .sidebar { width: 220px; background: #2c3e50; color: white; position: fixed; height: 100%; padding-top: 20px; }
    .sidebar button { display: block; background: none; color: white; border: none; width: 100%; text-align: right; padding: 15px; cursor: pointer; }
    .sidebar .bottom-buttons { position: absolute; bottom: 20px; width: 100%; }
    .content { margin-right: 220px; padding: 20px; }
    .filters { margin-bottom: 20px; }
    canvas { background: white; border-radius: 10px; box-shadow: 0 0 10px #ccc; margin-bottom: 20px; }
    #mainChart, #tableContainer { display: none; }
    #dataTable_wrapper { background: white; padding: 10px; border-radius: 10px; box-shadow: 0 0 10px #ccc; }
  </style>
</head>
<body>
<div class="login-page" id="loginPage">
  <div class="login-box">
    <h2 id="login-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <input type="text" id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
    <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button onclick="login()" id="login-button">Ø¯Ø®ÙˆÙ„</button>
  </div>
</div>
<div class="main-page" id="mainPage">
  <div class="sidebar">
    <button onclick="navigateChart('temp')">ðŸ“ˆ <span data-key="temp">Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©</span></button>
    <button onclick="navigateChart('humidity')">ðŸ’§ <span data-key="humidity">Ø§Ù„Ø±Ø·ÙˆØ¨Ø©</span></button>
    <button onclick="navigateChart('accel')">ðŸ§­ <span data-key="accel">Ø§Ù„ØªØ³Ø§Ø±Ø¹</span></button>
    <button onclick="navigateChart('gyro')">ðŸŒ€ <span data-key="gyro">Ø§Ù„Ø¬ÙŠØ±ÙˆØ³ÙƒÙˆØ¨</span></button>
    <button onclick="navigateChart('vibration')">ðŸ“³ <span data-key="vibration">Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø²</span></button>
    <button onclick="showTable()">ðŸ“‹ <span data-key="table">Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙƒØ§Ù…Ù„</span></button>
    <div class="bottom-buttons">
      <button onclick="changeLang('ar')">ðŸ‡²ðŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
      <button onclick="changeLang('fr')">ðŸ‡«ðŸ‡· FranÃ§ais</button>
      <button onclick="changeLang('en')">ðŸ‡¬ðŸ‡§ English</button>
      <button onclick="logout()" style="color: red;">ðŸšª <span data-key="logout">Ø®Ø±ÙˆØ¬</span></button>
    </div>
  </div>
  <div class="content">
    <div class="filters">
      <label data-key="date">Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
      <input type="date" id="dateFilter">
      <label data-key="from">Ù…Ù†:</label>
      <input type="time" id="timeFrom">
      <label data-key="to">Ø¥Ù„Ù‰:</label>
      <input type="time" id="timeTo">
      <button onclick="refreshData()" data-key="refresh">ØªØ­Ø¯ÙŠØ«</button>
    </div>
    <canvas id="mainChart" width="1000" height="400"></canvas>
    <div id="tableContainer">
      <table id="dataTable" class="display"></table>
    </div>
  </div>
</div>
<script>
const translations = {
  ar: { login: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„", temp: "Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©", humidity: "Ø§Ù„Ø±Ø·ÙˆØ¨Ø©", accel: "Ø§Ù„ØªØ³Ø§Ø±Ø¹", gyro: "Ø§Ù„Ø¬ÙŠØ±ÙˆØ³ÙƒÙˆØ¨", vibration: "Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø²", table: "Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙƒØ§Ù…Ù„", logout: "Ø®Ø±ÙˆØ¬", date: "Ø§Ù„ØªØ§Ø±ÙŠØ®:", from: "Ù…Ù†:", to: "Ø¥Ù„Ù‰:", refresh: "ØªØ­Ø¯ÙŠØ«" },
  fr: { login: "Connexion", temp: "TempÃ©rature", humidity: "HumiditÃ©", accel: "AccÃ©lÃ©ration", gyro: "Gyroscope", vibration: "Vibration", table: "Table complÃ¨te", logout: "DÃ©connexion", date: "Date:", from: "De:", to: "Ã€:", refresh: "RafraÃ®chir" },
  en: { login: "Login", temp: "Temperature", humidity: "Humidity", accel: "Acceleration", gyro: "Gyroscope", vibration: "Vibration", table: "Full Table", logout: "Logout", date: "Date:", from: "From:", to: "To:", refresh: "Refresh" }
};

function changeLang(lang) {
  document.querySelectorAll('[data-key]').forEach(el => {
    const key = el.getAttribute('data-key');
    el.innerText = translations[lang][key];
  });
  document.getElementById("login-title").innerText = translations[lang].login;
  document.getElementById("login-button").innerText = translations[lang].login;
}
function logout() {
  document.getElementById("mainPage").style.display = "none";
  document.getElementById("loginPage").style.display = "flex";
}
function login() {
  const user = document.getElementById("username").value;
  const pass = document.getElementById("password").value;
  if (user === "admin" && pass === "admin") {
    document.getElementById("loginPage").style.display = "none";
    document.getElementById("mainPage").style.display = "block";
    loadData();
  } else {
    alert("Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø®Ø§Ø·Ø¦Ø©");
  }
}
const scriptURL = "https://script.google.com/macros/s/AKfycbyyOjiF-mX-oC2AeYB2antb3GMRKsMLfzegN6DRx5Q_XsceQMNOjAipsAMyxPI3Ca2NDA/exec";
let fullData = [];
let chart;
function refreshData() {
  const selectedDate = document.getElementById("dateFilter").value;
  const fromTime = document.getElementById("timeFrom").value;
  const toTime = document.getElementById("timeTo").value;
  const filtered = fullData.filter(row => {
    const rowDate = row.Date;
    const rowTime = row.Time;
    return (!selectedDate || rowDate === selectedDate) &&
           (!fromTime || rowTime >= fromTime) &&
           (!toTime || rowTime <= toTime);
  });
  updateChart(filtered);
  updateTable(filtered);
}
function loadData() {
  fetch(scriptURL)
    .then(res => res.json())
    .then(data => {
      fullData = data;
      refreshData();
    });
}
function updateChart(data) {
  if (chart) chart.destroy();
  const ctx = document.getElementById("mainChart").getContext("2d");
  chart = new Chart(ctx, {
    type: "line",
    data: {
      labels: data.map(r => r.Time),
      datasets: [{ label: "Temperature", data: data.map(r => parseFloat(r["TempÃ©rature (Â°C)"])), borderColor: "#f00", fill: false }]
    }
  });
}
function updateTable(data) {
  if ($.fn.DataTable.isDataTable("#dataTable")) {
    $('#dataTable').DataTable().clear().rows.add(data).draw();
  } else {
    $('#dataTable').DataTable({ data, columns: Object.keys(data[0] || {}).map(key => ({ title: key, data: key })) });
  }
  document.getElementById("mainChart").style.display = "none";
  document.getElementById("tableContainer").style.display = "block";
}
function showTable() {
  refreshData();
  document.getElementById("mainChart").style.display = "none";
  document.getElementById("tableContainer").style.display = "block";
}
function navigateChart(type) {
  document.getElementById("mainChart").style.display = "block";
  document.getElementById("tableContainer").style.display = "none";
  if (!fullData.length) return;
  const selectedDate = document.getElementById("dateFilter").value;
  const fromTime = document.getElementById("timeFrom").value;
  const toTime = document.getElementById("timeTo").value;
  const filtered = fullData.filter(row => {
    const rowDate = row.Date;
    const rowTime = row.Time;
    return (!selectedDate || rowDate === selectedDate) &&
           (!fromTime || rowTime >= fromTime) &&
           (!toTime || rowTime <= toTime);
  });
  let label = "";
  let color = "#00f";
  if (type === "temp") { label = "TempÃ©rature (Â°C)"; color = "#f00"; }
  else if (type === "humidity") { label = "HumiditÃ© (%)"; color = "#00f"; }
  else if (type === "accel") { label = "AccÃ©lÃ©ration X"; color = "#0f0"; }
  else if (type === "gyro") { label = "Gyroscope X"; color = "#ff0"; }
  else if (type === "vibration") { label = "Vibration"; color = "#f0f"; }

  if (chart) chart.destroy();
  const ctx = document.getElementById("mainChart").getContext("2d");
  chart = new Chart(ctx, {
    type: "line",
    data: {
      labels: filtered.map(r => r.Time),
      datasets: [{ label, data: filtered.map(r => parseFloat(r[label])), borderColor: color, fill: false }]
    }
  });
}
</script>
</body>
</html>
