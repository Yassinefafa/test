<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ´Ø¹Ø± Ø§Ù„Ù…ØªØ·ÙˆØ±Ø©</title>
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“Š</text></svg>">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --secondary: #6366f1;
            --dark: #1e293b;
            --light: #f8fafc;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --purple: #8b5cf6;
            --gray: #94a3b8;
        }

        body {
            font-family: 'Inter', sans-serif;
            direction: rtl;
            text-align: right;
            background: linear-gradient(135deg, #f0f4f8, #e2e8f0);
            color: var(--dark);
            min-height: 100vh;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            box-shadow: 0 12px 24px rgba(59, 130, 246, 0.2);
        }

        .data-card {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(229, 231, 235, 0.5);
        }

        .data-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(59, 130, 246, 0.2);
        }

        .data-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .nav-button {
            transition: all 0.3s ease;
        }

        .nav-button.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
            transform: translateY(-2px);
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(241, 245, 249, 0.5);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        .loading-spinner {
            animation: spin 1.5s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(139, 92, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0); }
        }
        
        .insight-card {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.05), rgba(99, 102, 241, 0.05));
            border: 1px solid rgba(139, 92, 246, 0.2);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="glass-card mx-4 mt-4 mb-6 shadow-xl">
        <div class="flex flex-wrap justify-between items-center p-4">
            <div class="flex items-center space-x-3 space-x-reverse">
                <div class="p-3 bg-blue-100 rounded-xl">
                    <i class="fas fa-microchip text-blue-600 text-2xl"></i>
                </div>
                <div>
                    <h1 id="dashboardTitle" class="text-2xl font-bold text-gray-800">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ´Ø¹Ø±</h1>
                    <p class="text-gray-600 mt-1">Ù…Ø±Ø§Ù‚Ø¨Ø© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
                </div>
            </div>
            
            <div class="flex items-center space-x-4 space-x-reverse mt-4 sm:mt-0">
                <div class="flex items-center space-x-3 space-x-reverse text-gray-700">
                    <div id="currentDate" class="px-3 py-2 rounded-lg bg-blue-50 border border-blue-100 text-blue-700 font-medium"></div>
                    <div id="currentTime" class="px-3 py-2 rounded-lg bg-indigo-50 border border-indigo-100 text-indigo-700 font-medium"></div>
                </div>
                
                <!-- Language Selector -->
                <div class="flex space-x-2">
                    <button class="lang-button px-4 py-2 rounded-lg text-sm font-medium text-white bg-gray-600 hover:bg-gray-500 transition duration-300" data-lang="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
                    <button class="lang-button px-4 py-2 rounded-lg text-sm font-medium text-white bg-gray-600 hover:bg-gray-500 transition duration-300" data-lang="en">English</button>
                    <button class="lang-button px-4 py-2 rounded-lg text-sm font-medium text-white bg-blue-500 hover:bg-blue-400 transition duration-300" data-lang="fr">FranÃ§ais</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto px-4 pb-12">
        <div class="flex flex-col lg:flex-row gap-6">
            <!-- Navigation Sidebar -->
            <div class="w-full lg:w-1/4">
                <div class="glass-card p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 pb-2 border-b border-gray-200">Ø§Ù„ØªÙ†Ù‚Ù„</h2>
                    
                    <div class="space-y-3">
                        <button id="latestDataBtn" class="nav-button w-full flex items-center space-x-3 space-x-reverse px-5 py-3 rounded-xl text-lg font-semibold text-white bg-blue-500 hover:bg-blue-400 transition duration-300 active" data-target="latestData">
                            <i class="fas fa-bolt text-yellow-200"></i>
                            <span>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©</span>
                        </button>
                        
                        <button id="accelGyroBtn" class="nav-button w-full flex items-center space-x-3 space-x-reverse px-5 py-3 rounded-xl text-lg font-semibold text-white bg-blue-500 hover:bg-blue-400 transition duration-300" data-target="accelGyroData">
                            <i class="fas fa-compress-arrows-alt text-purple-200"></i>
                            <span>ØªØ³Ø§Ø±Ø¹ ÙˆØ¬ÙŠØ±ÙˆØ³ÙƒÙˆØ¨</span>
                        </button>
                        
                        <button id="fullTableBtn" class="nav-button w-full flex items-center space-x-3 space-x-reverse px-5 py-3 rounded-xl text-lg font-semibold text-white bg-blue-500 hover:bg-blue-400 transition duration-300" data-target="fullTable">
                            <i class="fas fa-table text-green-200"></i>
                            <span>Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙƒØ§Ù…Ù„</span>
                        </button>
                        
                        <button id="chartsBtn" class="nav-button w-full flex items-center space-x-3 space-x-reverse px-5 py-3 rounded-xl text-lg font-semibold text-white bg-blue-500 hover:bg-blue-400 transition duration-300" data-target="charts">
                            <i class="fas fa-chart-line text-red-200"></i>
                            <span>Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©</span>
                        </button>
                    </div>
                    
                    <div class="mt-8 pt-6 border-t border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ØªØ­Ø¯ÙŠØ«</h3>
                        <button id="autoRefreshToggleBtn" class="w-full flex items-center justify-center space-x-2 px-5 py-3 rounded-xl text-lg font-semibold text-white bg-green-500 hover:bg-green-400 transition duration-300 pulse">
                            <i class="fas fa-sync-alt"></i>
                            <span>ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ: ØªØ´ØºÙŠÙ„</span>
                        </button>
                        
                        <button id="manualRefreshBtn" class="w-full flex items-center justify-center space-x-2 px-5 py-3 rounded-xl text-lg font-semibold text-white bg-indigo-500 hover:bg-indigo-400 transition duration-300 mt-3">
                            <i class="fas fa-redo"></i>
                            <span>ØªØ­Ø¯ÙŠØ« ÙŠØ¯ÙˆÙŠ</span>
                        </button>
                    </div>
                    
                    <div class="mt-8 pt-6 border-t border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">Ø§ØªØµØ§Ù„ Ø§Ù„Ø®Ø§Ø¯Ù…</span>
                                <span class="h-3 w-3 rounded-full bg-green-500 animate-pulse"></span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">Ù…Ø³ØªØ´Ø¹Ø±Ø§Øª Ù†Ø´Ø·Ø©</span>
                                <span class="text-blue-600 font-medium">3/3</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</span>
                                <span id="lastUpdateTime" class="text-gray-700 font-medium">--:--:--</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content Area -->
            <div class="w-full lg:w-3/4">
                <!-- Loading Indicator -->
                <div id="loading" class="glass-card text-center text-xl font-semibold text-blue-600 p-8 my-6 hidden">
                    <div class="flex flex-col items-center justify-center">
                        <div class="loading-spinner h-16 w-16 rounded-full border-4 border-blue-500 border-t-transparent mb-4"></div>
                        <span id="loadingText">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</span>
                    </div>
                </div>

                <!-- Error Message -->
                <div id="errorMessage" class="glass-card bg-red-50 border border-red-200 text-red-700 p-4 rounded-lg my-6 hidden" role="alert">
                    <div class="flex justify-between items-start">
                        <div>
                            <strong id="errorTitle" class="font-bold">Ø®Ø·Ø£!</strong>
                            <span class="block mt-1" id="errorText">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù…ØµØ¯Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­ Ùˆ Apps Script Ù…Ù†Ø´ÙˆØ± Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.</span>
                        </div>
                        <button onclick="document.getElementById('errorMessage').classList.add('hidden')" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>

                <!-- Latest Data Section -->
                <section id="latestData" class="page-content glass-card p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 id="latestDataTitle" class="text-2xl font-bold text-gray-800">
                            <i class="fas fa-bolt text-yellow-500 mr-2"></i>
                            Ø£Ø­Ø¯Ø« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ´Ø¹Ø±
                        </h2>
                        <div class="text-sm text-gray-600">
                            <i class="fas fa-clock mr-1"></i>
                            <span id="latestDataTimestamp">--:--:--</span>
                        </div>
                    </div>
                    
                    <div class="flex justify-end mb-6">
                        <button id="generateInsightBtn" class="px-6 py-3 rounded-xl text-lg font-semibold text-white bg-purple-600 hover:bg-purple-500 transition duration-300 transform hover:scale-105 shadow-md flex items-center space-x-2 space-x-reverse">
                            <i class="fas fa-lightbulb"></i>
                            <span>ØªÙˆÙ„ÙŠØ¯ Ø±Ø¤Ù‰ âœ¨</span>
                        </button>
                    </div>
                    
                    <div id="latestDataContent" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Latest data will be injected here -->
                    </div>
                    
                    <!-- Insight Card -->
                    <div id="insightCard" class="insight-card p-6 rounded-xl mt-8 hidden">
                        <h3 id="insightCardTitle" class="text-xl font-semibold text-purple-700 mb-4">
                            <i class="fas fa-brain mr-2"></i>
                            Ø±Ø¤Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </h3>
                        <p id="insightContent" class="text-gray-800 text-base leading-relaxed"></p>
                        <div id="insightLoading" class="text-center text-sm text-purple-600 mt-4 hidden">
                            <svg class="animate-spin h-5 w-5 inline-block text-purple-600 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <span id="insightLoadingText">Ø¬Ø§Ø±Ù ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ø¤Ù‰...</span>
                        </div>
                    </div>
                </section>

                <!-- Acceleration and Gyroscope Data Section -->
                <section id="accelGyroData" class="page-content glass-card p-6 hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 id="accelGyroTitle" class="text-2xl font-bold text-gray-800">
                            <i class="fas fa-compress-arrows-alt text-purple-500 mr-2"></i>
                            Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ø§Ø±Ø¹ ÙˆØ§Ù„Ø¬ÙŠØ±ÙˆØ³ÙƒÙˆØ¨
                        </h2>
                        <div class="text-sm text-gray-600">
                            <i class="fas fa-clock mr-1"></i>
                            <span id="accelGyroTimestamp">--:--:--</span>
                        </div>
                    </div>
                    <div id="accelGyroContent" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Acceleration and Gyroscope data will be injected here -->
                    </div>
                </section>

                <!-- Full Table Section -->
                <section id="fullTable" class="page-content glass-card p-6 hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 id="fullTableTitle" class="text-2xl font-bold text-gray-800">
                            <i class="fas fa-table text-green-500 mr-2"></i>
                            Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù…Ø¹ Ø§Ù„ØªØµÙÙŠØ©
                        </h2>
                        <div class="text-sm text-gray-600">
                            <span id="tableDataCount">0</span> Ø³Ø¬Ù„Ø§Øª
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="mb-8 p-6 bg-gray-50 rounded-xl shadow-inner border border-gray-100">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-4">
                            <div>
                                <label id="fromDateLabel" for="fromDate" class="block text-gray-700 text-sm font-medium mb-2">Ù…Ù† ØªØ§Ø±ÙŠØ®:</label>
                                <div class="relative">
                                    <input type="date" id="fromDate" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-200">
                                    <i class="fas fa-calendar absolute left-3 top-3.5 text-gray-400"></i>
                                </div>
                            </div>
                            <div>
                                <label id="toDateLabel" for="toDate" class="block text-gray-700 text-sm font-medium mb-2">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®:</label>
                                <div class="relative">
                                    <input type="date" id="toDate" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-200">
                                    <i class="fas fa-calendar absolute left-3 top-3.5 text-gray-400"></i>
                                </div>
                            </div>
                            <div>
                                <label id="fromTimeLabel" for="fromTime" class="block text-gray-700 text-sm font-medium mb-2">Ù…Ù† ØªÙˆÙ‚ÙŠØª:</label>
                                <div class="relative">
                                    <input type="time" id="fromTime" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-200">
                                    <i class="fas fa-clock absolute left-3 top-3.5 text-gray-400"></i>
                                </div>
                            </div>
                            <div>
                                <label id="toTimeLabel" for="toTime" class="block text-gray-700 text-sm font-medium mb-2">Ø¥Ù„Ù‰ ØªÙˆÙ‚ÙŠØª:</label>
                                <div class="relative">
                                    <input type="time" id="toTime" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-200">
                                    <i class="fas fa-clock absolute left-3 top-3.5 text-gray-400"></i>
                                </div>
                            </div>
                        </div>
                        <div class="flex justify-start space-x-4 space-x-reverse">
                            <button id="applyFiltersBtn" class="px-6 py-3 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 transition duration-300 transform hover:scale-105 shadow-lg flex items-center">
                                <i class="fas fa-filter mr-2"></i>
                                ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØµÙÙŠØ©
                            </button>
                            <button id="resetFiltersBtn" class="px-6 py-3 bg-red-500 text-white font-bold rounded-lg hover:bg-red-600 transition duration-300 transform hover:scale-105 shadow-lg flex items-center">
                                <i class="fas fa-redo mr-2"></i>
                                Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                            </button>
                        </div>
                    </div>

                    <!-- Data Table -->
                    <div class="overflow-x-auto rounded-lg shadow-md border border-gray-200">
                        <table id="dataTable" class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-100">
                                <tr id="tableHeaderRow">
                                    <!-- Headers will be injected here -->
                                </tr>
                            </thead>
                            <tbody id="tableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Data rows will be injected here -->
                            </tbody>
                        </table>
                        <div id="noDataFound" class="hidden text-center py-8 text-gray-500 text-lg">
                            <i class="fas fa-database text-4xl mb-4 text-gray-300"></i>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ØªØµÙÙŠØ©.</p>
                        </div>
                    </div>
                </section>

                <!-- Charts Section -->
                <section id="charts" class="page-content glass-card p-6 hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 id="chartsTitle" class="text-2xl font-bold text-gray-800">
                            <i class="fas fa-chart-line text-red-500 mr-2"></i>
                            Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ´Ø¹Ø±
                        </h2>
                        <div class="text-sm text-gray-600">
                            <span id="chartDataCount">0</span> Ù†Ù‚Ø§Ø· Ø¨ÙŠØ§Ù†Ø§Øª
                        </div>
                    </div>
                    <div id="chartsContainer" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- Charts will be injected here -->
                    </div>
                </section>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let sensorData = [];
        const chartInstances = {};
        let currentLanguage = 'ar'; // Default language is Arabic
        let autoRefreshIntervalId = null;
        let lastUpdateTimestamp = null;

        // DOM Elements
        const loadingIndicator = document.getElementById('loading');
        const errorMessageDiv = document.getElementById('errorMessage');
        const errorTextSpan = document.getElementById('errorText');
        const latestDataContent = document.getElementById('latestDataContent');
        const tableHeaderRow = document.getElementById('tableHeaderRow');
        const tableBody = document.getElementById('tableBody');
        const fromDateInput = document.getElementById('fromDate');
        const toDateInput = document.getElementById('toDate');
        const fromTimeInput = document.getElementById('fromTime');
        const toTimeInput = document.getElementById('toTime');
        const applyFiltersBtn = document.getElementById('applyFiltersBtn');
        const resetFiltersBtn = document.getElementById('resetFiltersBtn');
        const noDataFoundDiv = document.getElementById('noDataFound');
        const chartsContainer = document.getElementById('chartsContainer');
        const currentDateDisplay = document.getElementById('currentDate');
        const currentTimeDisplay = document.getElementById('currentTime');
        const dashboardTitle = document.getElementById('dashboardTitle');
        const latestDataTitle = document.getElementById('latestDataTitle');
        const fullTableTitle = document.getElementById('fullTableTitle');
        const chartsTitle = document.getElementById('chartsTitle');
        const fromDateLabel = document.getElementById('fromDateLabel');
        const toDateLabel = document.getElementById('toDateLabel');
        const fromTimeLabel = document.getElementById('fromTimeLabel');
        const toTimeLabel = document.getElementById('toTimeLabel');
        const loadingText = document.getElementById('loadingText');
        const errorTitle = document.getElementById('errorTitle');
        const accelGyroTitle = document.getElementById('accelGyroTitle');
        const accelGyroContent = document.getElementById('accelGyroContent');
        const autoRefreshToggleBtn = document.getElementById('autoRefreshToggleBtn');
        const manualRefreshBtn = document.getElementById('manualRefreshBtn');
        const latestDataTimestamp = document.getElementById('latestDataTimestamp');
        const accelGyroTimestamp = document.getElementById('accelGyroTimestamp');
        const tableDataCount = document.getElementById('tableDataCount');
        const chartDataCount = document.getElementById('chartDataCount');
        const lastUpdateTime = document.getElementById('lastUpdateTime');
        const generateInsightBtn = document.getElementById('generateInsightBtn');
        const insightCard = document.getElementById('insightCard');
        const insightCardTitle = document.getElementById('insightCardTitle');
        const insightContent = document.getElementById('insightContent');
        const insightLoading = document.getElementById('insightLoading');
        const insightLoadingText = document.getElementById('insightLoadingText');

        // Metrics to display as charts
        const chartMetrics = [
            'TempÃ©rature (Â°C)', 'HumiditÃ© (%)', 'AccÃ©lÃ©ration X', 'AccÃ©lÃ©ration Y',
            'AccÃ©lÃ©ration Z', 'Gyroscope X', 'Gyroscope Y', 'Gyroscope Z',
            'Vibration', 'Temp. NTC (Â°C)', 'Courant (V Bruts)', 'Batterie (V)'
        ];

        // Define a set of appealing colors for charts
        const chartColors = [
            'rgb(75, 192, 192)', // Teal
            'rgb(255, 99, 132)', // Red
            'rgb(54, 162, 235)', // Blue
            'rgb(255, 205, 86)', // Yellow
            'rgb(153, 102, 255)',// Purple
            'rgb(255, 159, 64)', // Orange
            'rgb(201, 203, 207)',// Grey
            'rgb(102, 204, 0)',  // Lime Green
            'rgb(255, 102, 204)',// Pink
            'rgb(0, 153, 153)',  // Dark Teal
            'rgb(204, 51, 0)',   // Dark Red-Orange
            'rgb(51, 102, 255)'  // Royal Blue
        ];

        // Define a set of different point styles for charts
        const pointStyles = [
            'circle',
            'triangle',
            'rect',
            'star',
            'cross',
            'crossRot',
            'dash',
            'line',
            'rectRounded',
            'rectRot',
            'triangle'
        ];

        // Translation object
        const translations = {
            'ar': {
                dashboardTitle: 'Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ´Ø¹Ø±',
                latestDataBtn: 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©',
                accelGyroBtn: 'ØªØ³Ø§Ø±Ø¹ ÙˆØ¬ÙŠØ±ÙˆØ³ÙƒÙˆØ¨',
                fullTableBtn: 'Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙƒØ§Ù…Ù„',
                chartsBtn: 'Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©',
                loadingText: 'Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...',
                errorTitle: 'Ø®Ø·Ø£!',
                errorText: 'ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù…ØµØ¯Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­ Ùˆ Apps Script Ù…Ù†Ø´ÙˆØ± Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.',
                latestDataTitle: 'Ø£Ø­Ø¯Ø« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ´Ø¹Ø±',
                accelGyroTitle: 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ø§Ø±Ø¹ ÙˆØ§Ù„Ø¬ÙŠØ±ÙˆØ³ÙƒÙˆØ¨',
                fullTableTitle: 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù…Ø¹ Ø§Ù„ØªØµÙÙŠØ©',
                fromDateLabel: 'Ù…Ù† ØªØ§Ø±ÙŠØ®:',
                toDateLabel: 'Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®:',
                fromTimeLabel: 'Ù…Ù† ØªÙˆÙ‚ÙŠØª:',
                toTimeLabel: 'Ø¥Ù„Ù‰ ØªÙˆÙ‚ÙŠØª:',
                applyFiltersBtn: 'ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØµÙÙŠØ©',
                resetFiltersBtn: 'Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†',
                noDataFound: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø£Ùˆ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ØªØµÙÙŠØ©.',
                chartsTitle: 'Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ´Ø¹Ø±',
                invalidDate: 'ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ§Ù„Ø­',
                invalidTime: 'ÙˆÙ‚Øª ØºÙŠØ± ØµØ§Ù„Ø­',
                invalidValue: 'ØºÙŠØ± ØµØ§Ù„Ø­',
                autoRefreshOn: 'ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ: ØªØ´ØºÙŠÙ„',
                autoRefreshOff: 'ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ: Ø¥ÙŠÙ‚Ø§Ù',
                manualRefresh: 'ØªØ­Ø¯ÙŠØ« ÙŠØ¯ÙˆÙŠ',
                records: 'Ø³Ø¬Ù„Ø§Øª',
                dataPoints: 'Ù†Ù‚Ø§Ø· Ø¨ÙŠØ§Ù†Ø§Øª',
                generateInsightBtn: 'ØªÙˆÙ„ÙŠØ¯ Ø±Ø¤Ù‰ âœ¨',
                insightCardTitle: 'Ø±Ø¤Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
                noDataForInsight: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø© Ù„ØªÙˆÙ„ÙŠØ¯ Ø±Ø¤Ù‰.',
                generatingInsight: 'Ø¬Ø§Ø±Ù ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ø¤Ù‰...',
                insightError: 'ÙØ´Ù„ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ø¤Ù‰. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.',
                insightFetchError: 'Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø±Ø¤Ù‰ Ù…Ù† Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ',
                chartLabels: {
                    'Timestamp': 'Ø§Ù„Ø®ØªÙ… Ø§Ù„Ø²Ù…Ù†ÙŠ',
                    'Date': 'Ø§Ù„ØªØ§Ø±ÙŠØ®',
                    'Heure': 'Ø§Ù„ØªÙˆÙ‚ÙŠØª',
                    'TempÃ©rature (Â°C)': 'Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© (Â°C)',
                    'HumiditÃ© (%)': 'Ø§Ù„Ø±Ø·ÙˆØ¨Ø© (%)',
                    'AccÃ©lÃ©ration X': 'Ø§Ù„ØªØ³Ø§Ø±Ø¹ X',
                    'AccÃ©lÃ©ration Y': 'Ø§Ù„ØªØ³Ø§Ø±Ø¹ Y',
                    'AccÃ©lÃ©ration Z': 'Ø§Ù„ØªØ³Ø§Ø±Ø¹ Z',
                    'Gyroscope X': 'Ø¬ÙŠØ±ÙˆØ³ÙƒÙˆØ¨ X',
                    'Gyroscope Y': 'Ø¬ÙŠØ±ÙˆØ³ÙƒÙˆØ¨ Y',
                    'Gyroscope Z': 'Ø¬ÙŠØ±ÙˆØ³ÙƒÙˆØ¨ Z',
                    'Vibration': 'Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø²',
                    'Temp. NTC (Â°C)': 'Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© NTC (Â°C)',
                    'Courant (V Bruts)': 'Ø§Ù„ØªÙŠØ§Ø± (ÙÙˆÙ„Øª Ø®Ø§Ù…)',
                    'Batterie (V)': 'Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ© (ÙÙˆÙ„Øª)'
                }
            },
            'en': {
                dashboardTitle: 'Sensor Data Dashboard',
                latestDataBtn: 'Latest Data',
                accelGyroBtn: 'Acceleration & Gyro',
                fullTableBtn: 'Full Table',
                chartsBtn: 'Charts',
                loadingText: 'Loading data...',
                errorTitle: 'Error!',
                errorText: 'Failed to load data. Please ensure the data source is available and Apps Script is correctly deployed.',
                latestDataTitle: 'Latest Sensor Data',
                accelGyroTitle: 'Acceleration and Gyroscope Data',
                fullTableTitle: 'Full Data with Filters',
                fromDateLabel: 'From Date:',
                toDateLabel: 'To Date:',
                fromTimeLabel: 'From Time:',
                toTimeLabel: 'To Time:',
                applyFiltersBtn: 'Apply Filter',
                resetFiltersBtn: 'Reset',
                noDataFound: 'No data to display or no data matching filter criteria.',
                chartsTitle: 'Sensor Data Charts',
                invalidDate: 'Invalid Date',
                invalidTime: 'Invalid Time',
                invalidValue: 'Invalid',
                autoRefreshOn: 'Auto Refresh: ON',
                autoRefreshOff: 'Auto Refresh: OFF',
                manualRefresh: 'Manual Refresh',
                records: 'records',
                dataPoints: 'data points',
                generateInsightBtn: 'Generate Insight âœ¨',
                insightCardTitle: 'Data Insight',
                noDataForInsight: 'No data available to generate insights.',
                generatingInsight: 'Generating insight...',
                insightError: 'Failed to generate insight. Please try again.',
                insightFetchError: 'Error fetching insight from AI',
                chartLabels: {
                    'Timestamp': 'Timestamp',
                    'Date': 'Date',
                    'Heure': 'Time',
                    'TempÃ©rature (Â°C)': 'Temperature (Â°C)',
                    'HumiditÃ© (%)': 'Humidity (%)',
                    'AccÃ©lÃ©ration X': 'Acceleration X',
                    'AccÃ©lÃ©ration Y': 'Acceleration Y',
                    'AccÃ©lÃ©ration Z': 'Acceleration Z',
                    'Gyroscope X': 'Gyroscope X',
                    'Gyroscope Y': 'Gyroscope Y',
                    'Gyroscope Z': 'Gyroscope Z',
                    'Vibration': 'Vibration',
                    'Temp. NTC (Â°C)': 'NTC Temp (Â°C)',
                    'Courant (V Bruts)': 'Current (Raw V)',
                    'Batterie (V)': 'Battery (V)'
                }
            },
            'fr': {
                dashboardTitle: 'Tableau de Bord des DonnÃ©es',
                latestDataBtn: 'DerniÃ¨res DonnÃ©es',
                accelGyroBtn: 'AccÃ©lÃ©ration & Gyro',
                fullTableBtn: 'Tableau Complet',
                chartsBtn: 'Graphiques',
                loadingText: 'Chargement des donnÃ©es...',
                errorTitle: 'Erreur!',
                errorText: 'Ã‰chec du chargement des donnÃ©es. Veuillez vous assurer que la source de donnÃ©es est disponible et que le script Apps Script est correctement dÃ©ployÃ©.',
                latestDataTitle: 'DerniÃ¨res DonnÃ©es des Capteurs',
                accelGyroTitle: 'DonnÃ©es d\'AccÃ©lÃ©ration et de Gyroscope',
                fullTableTitle: 'Tableau Complet des DonnÃ©es avec Filtres',
                fromDateLabel: 'Du Date:',
                toDateLabel: 'Au Date:',
                fromTimeLabel: 'Du Temps:',
                toTimeLabel: 'Au Temps:',
                applyFiltersBtn: 'Appliquer le Filtre',
                resetFiltersBtn: 'RÃ©initialiser',
                noDataFound: 'Aucune donnÃ©e Ã  afficher ou aucune donnÃ©e ne correspond aux critÃ¨res de filtre.',
                chartsTitle: 'Graphiques des DonnÃ©es des Capteurs',
                invalidDate: 'Date Invalide',
                invalidTime: 'Heure Invalide',
                invalidValue: 'Invalide',
                autoRefreshOn: 'Actualisation automatique: ON',
                autoRefreshOff: 'Actualisation automatique: OFF',
                manualRefresh: 'Actualisation manuelle',
                records: 'enregistrements',
                dataPoints: 'points de donnÃ©es',
                generateInsightBtn: 'GÃ©nÃ©rer une perspicacitÃ© âœ¨',
                insightCardTitle: 'PerspicacitÃ© des DonnÃ©es',
                noDataForInsight: 'Aucune donnÃ©e disponible pour gÃ©nÃ©rer des perspicacitÃ©s.',
                generatingInsight: 'GÃ©nÃ©ration de la perspicacitÃ©...',
                insightError: 'Ã‰chec de la gÃ©nÃ©ration de la perspicacitÃ©. Veuillez rÃ©essayer.',
                insightFetchError: 'Erreur lors de la rÃ©cupÃ©ration de la perspicacitÃ© de l\'IA',
                chartLabels: {
                    'Timestamp': 'Horodatage',
                    'Date': 'Date',
                    'Heure': 'Heure',
                    'TempÃ©rature (Â°C)': 'TempÃ©rature (Â°C)',
                    'HumiditÃ© (%)': 'HumiditÃ© (%)',
                    'AccÃ©lÃ©ration X': 'AccÃ©lÃ©ration X',
                    'AccÃ©lÃ©ration Y': 'AccÃ©lÃ©ration Y',
                    'AccÃ©lÃ©ration Z': 'AccÃ©lÃ©ration Z',
                    'Gyroscope X': 'Gyroscope X',
                    'Gyroscope Y': 'Gyroscope Y',
                    'Gyroscope Z': 'Gyroscope Z',
                    'Vibration': 'Vibration',
                    'Temp. NTC (Â°C)': 'Temp. NTC (Â°C)',
                    'Courant (V Bruts)': 'Courant (V bruts)',
                    'Batterie (V)': 'Batterie (V)'
                }
            }
        };

        // Simulated data fetching function
        function fetchData() {
            loadingIndicator.classList.remove('hidden');
            
            // Simulate API call delay
            setTimeout(() => {
                // Sample sensor data
                sensorData = [
                    {
                        "Timestamp": "2025-06-28T12:00:00.000Z",
                        "Date": "2025-06-28",
                        "Heure": "15:00:00",
                        "TempÃ©rature (Â°C)": "25.3",
                        "HumiditÃ© (%)": "45.2",
                        "AccÃ©lÃ©ration X": "0.12",
                        "AccÃ©lÃ©ration Y": "0.05",
                        "AccÃ©lÃ©ration Z": "0.98",
                        "Gyroscope X": "0.01",
                        "Gyroscope Y": "0.03",
                        "Gyroscope Z": "0.02",
                        "Vibration": "2.3",
                        "Temp. NTC (Â°C)": "26.1",
                        "Courant (V Bruts)": "3.45",
                        "Batterie (V)": "4.18"
                    },
                    {
                        "Timestamp": "2025-06-28T12:05:00.000Z",
                        "Date": "2025-06-28",
                        "Heure": "15:05:00",
                        "TempÃ©rature (Â°C)": "25.5",
                        "HumiditÃ© (%)": "45.5",
                        "AccÃ©lÃ©ration X": "0.15",
                        "AccÃ©lÃ©ration Y": "0.07",
                        "AccÃ©lÃ©ration Z": "0.95",
                        "Gyroscope X": "0.02",
                        "Gyroscope Y": "0.04",
                        "Gyroscope Z": "0.01",
                        "Vibration": "2.5",
                        "Temp. NTC (Â°C)": "26.3",
                        "Courant (V Bruts)": "3.42",
                        "Batterie (V)": "4.17"
                    },
                    {
                        "Timestamp": "2025-06-28T12:10:00.000Z",
                        "Date": "2025-06-28",
                        "Heure": "15:10:00",
                        "TempÃ©rature (Â°C)": "25.7",
                        "HumiditÃ© (%)": "45.8",
                        "AccÃ©lÃ©ration X": "0.18",
                        "AccÃ©lÃ©ration Y": "0.09",
                        "AccÃ©lÃ©ration Z": "0.92",
                        "Gyroscope X": "0.03",
                        "Gyroscope Y": "0.05",
                        "Gyroscope Z": "0.03",
                        "Vibration": "2.7",
                        "Temp. NTC (Â°C)": "26.5",
                        "Courant (V Bruts)": "3.39",
                        "Batterie (V)": "4.16"
                    }
                ];
                
                lastUpdateTimestamp = new Date();
                const formattedTime = lastUpdateTimestamp.toLocaleTimeString(currentLanguage, { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                const formattedDate = lastUpdateTimestamp.toLocaleDateString(currentLanguage, { year: 'numeric', month: 'short', day: 'numeric' });
                lastUpdateTime.textContent = `${formattedDate} ${formattedTime}`;
                
                renderLatestData(sensorData);
                renderAccelGyroData(sensorData);
                
                loadingIndicator.classList.add('hidden');
            }, 1500);
        }

        /**
         * Helper function to get only the date part formatted for local display.
         */
        function getFormattedDateForDisplay(dateValue, timeValue) {
            const dateObj = new Date(`${dateValue}T${timeValue}Z`);
            if (dateObj && !isNaN(dateObj.getTime())) {
                return dateObj.toLocaleDateString(currentLanguage, { year: 'numeric', month: '2-digit', day: '2-digit' });
            }
            return translations[currentLanguage].invalidDate;
        }

        /**
         * Helper function to get only the time part formatted for local display.
         */
        function getFormattedTimeForDisplay(dateValue, timeValue) {
            const dateObj = new Date(`${dateValue}T${timeValue}Z`);
            if (dateObj && !isNaN(dateObj.getTime())) {
                return dateObj.toLocaleTimeString(currentLanguage, { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
            }
            return translations[currentLanguage].invalidTime;
        }
        
        /**
         * Helper function to format numeric values.
         */
        function formatNumericValue(value) {
            const parsedValue = parseFloat(value);
            if (!isNaN(parsedValue)) {
                return parsedValue.toLocaleString(currentLanguage, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            }
            return translations[currentLanguage].invalidValue;
        }

        /**
         * Updates the display with the current local date and time.
         */
        function updateCurrentDateTimeDisplay() {
            const now = new Date();
            const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };

            currentDateDisplay.textContent = now.toLocaleDateString(currentLanguage, dateOptions);
            currentTimeDisplay.textContent = now.toLocaleTimeString(currentLanguage, timeOptions);
        }

        /**
         * Shows a specific page section and hides others.
         */
        function showPage(pageId) {
            // Update active button state
            document.querySelectorAll('.nav-button').forEach(button => {
                button.classList.remove('active');
                if (button.dataset.target === pageId) {
                    button.classList.add('active');
                }
            });

            // Hide all content sections
            document.querySelectorAll('.page-content').forEach(section => {
                section.classList.add('hidden');
            });
            // Show the requested content section
            document.getElementById(pageId).classList.remove('hidden');

            // Re-render the specific section that is now visible
            if (pageId === 'latestData') {
                renderLatestData(sensorData);
            } else if (pageId === 'fullTable') {
                renderFullTable(sensorData);
            } else if (pageId === 'accelGyroData') {
                renderAccelGyroData(sensorData);
            }
        }

        /**
         * Renders the latest sensor data.
         */
        function renderLatestData(data) {
            latestDataContent.innerHTML = '';
            if (data.length === 0) {
                latestDataContent.innerHTML = `<div class="col-span-full text-center py-8 text-gray-500">
                    <i class="fas fa-database text-4xl mb-4 text-gray-300"></i>
                    <p>${translations[currentLanguage].noDataFound}</p>
                </div>`;
                latestDataTimestamp.textContent = '--:--:--';
                insightCard.classList.add('hidden');
                return;
            }

            const latestEntry = data[data.length - 1];
            const dateObj = new Date(`${latestEntry.Date}T${latestEntry.Heure}Z`);
            if (dateObj) {
                latestDataTimestamp.textContent = dateObj.toLocaleTimeString(currentLanguage, { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            } else {
                latestDataTimestamp.textContent = '--:--:--';
            }

            // Dynamic labels based on current language
            const labels = translations[currentLanguage].chartLabels;

            for (const key in latestEntry) {
                if (latestEntry.hasOwnProperty(key) && !['AccÃ©lÃ©ration X', 'AccÃ©lÃ©ration Y', 'AccÃ©lÃ©ration Z', 'Gyroscope X', 'Gyroscope Y', 'Gyroscope Z'].includes(key)) {
                    let valueToDisplay = latestEntry[key];
                    if (key === 'Date') {
                        valueToDisplay = getFormattedDateForDisplay(valueToDisplay, latestEntry['Heure']);
                    } else if (key === 'Heure') {
                        valueToDisplay = getFormattedTimeForDisplay(latestEntry['Date'], valueToDisplay);
                    } else if (chartMetrics.includes(key)) {
                        valueToDisplay = formatNumericValue(valueToDisplay);
                    }

                    const displayLabel = labels[key] || key;

                    const dataCard = document.createElement('div');
                    dataCard.className = 'data-card bg-white p-6 rounded-xl shadow-sm border border-gray-100';
                    dataCard.innerHTML = `
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg font-semibold text-blue-700">${displayLabel}</h3>
                            <div class="p-2 bg-blue-100 rounded-lg">
                                <i class="fas fa-sensor text-blue-600"></i>
                            </div>
                        </div>
                        <p class="text-3xl font-bold text-gray-900 mb-1">${valueToDisplay}</p>
                        <div class="text-sm text-gray-500">${key === 'Date' ? labels['Heure'] : key === 'Heure' ? labels['Date'] : ''}</div>
                    `;
                    latestDataContent.appendChild(dataCard);
                }
            }
            insightCard.classList.add('hidden');
            insightContent.textContent = '';
        }

        /**
         * Renders acceleration and gyroscope data.
         */
        function renderAccelGyroData(data) {
            accelGyroContent.innerHTML = '';
            if (data.length === 0) {
                accelGyroContent.innerHTML = `<div class="col-span-full text-center py-8 text-gray-500">
                    <i class="fas fa-database text-4xl mb-4 text-gray-300"></i>
                    <p>${translations[currentLanguage].noDataFound}</p>
                </div>`;
                accelGyroTimestamp.textContent = '--:--:--';
                return;
            }

            const latestEntry = data[data.length - 1];
            const dateObj = new Date(`${latestEntry.Date}T${latestEntry.Heure}Z`);
            if (dateObj) {
                accelGyroTimestamp.textContent = dateObj.toLocaleTimeString(currentLanguage, { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            } else {
                accelGyroTimestamp.textContent = '--:--:--';
            }

            const labels = translations[currentLanguage].chartLabels;

            // Create Acceleration Card
            const accelCard = document.createElement('div');
            accelCard.className = 'data-card bg-white p-6 rounded-xl shadow-sm border border-gray-100';
            accelCard.innerHTML = `
                <div class="flex justify-between items-start mb-4">
                    <h3 class="text-xl font-semibold text-purple-700">${labels['AccÃ©lÃ©ration X'].replace(' X', '')}</h3>
                    <div class="p-2 bg-purple-100 rounded-lg">
                        <i class="fas fa-running text-purple-600"></i>
                    </div>
                </div>
                <div class="space-y-3">
                    <div class="flex justify-between items-center border-b border-gray-100 pb-3">
                        <span class="text-gray-600">${labels['AccÃ©lÃ©ration X']}</span>
                        <span class="text-lg font-bold text-purple-700">${formatNumericValue(latestEntry['AccÃ©lÃ©ration X'])}</span>
                    </div>
                    <div class="flex justify-between items-center border-b border-gray-100 pb-3">
                        <span class="text-gray-600">${labels['AccÃ©lÃ©ration Y']}</span>
                        <span class="text-lg font-bold text-purple-700">${formatNumericValue(latestEntry['AccÃ©lÃ©ration Y'])}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">${labels['AccÃ©lÃ©ration Z']}</span>
                        <span class="text-lg font-bold text-purple-700">${formatNumericValue(latestEntry['AccÃ©lÃ©ration Z'])}</span>
                    </div>
                </div>
            `;
            accelGyroContent.appendChild(accelCard);

            // Create Gyroscope Card
            const gyroCard = document.createElement('div');
            gyroCard.className = 'data-card bg-white p-6 rounded-xl shadow-sm border border-gray-100';
            gyroCard.innerHTML = `
                <div class="flex justify-between items-start mb-4">
                    <h3 class="text-xl font-semibold text-indigo-700">${labels['Gyroscope X'].replace(' X', '')}</h3>
                    <div class="p-2 bg-indigo-100 rounded-lg">
                        <i class="fas fa-sync-alt text-indigo-600"></i>
                    </div>
                </div>
                <div class="space-y-3">
                    <div class="flex justify-between items-center border-b border-gray-100 pb-3">
                        <span class="text-gray-600">${labels['Gyroscope X']}</span>
                        <span class="text-lg font-bold text-indigo-700">${formatNumericValue(latestEntry['Gyroscope X'])}</span>
                    </div>
                    <div class="flex justify-between items-center border-b border-gray-100 pb-3">
                        <span class="text-gray-600">${labels['Gyroscope Y']}</span>
                        <span class="text-lg font-bold text-indigo-700">${formatNumericValue(latestEntry['Gyroscope Y'])}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">${labels['Gyroscope Z']}</span>
                        <span class="text-lg font-bold text-indigo-700">${formatNumericValue(latestEntry['Gyroscope Z'])}</span>
                    </div>
                </div>
            `;
            accelGyroContent.appendChild(gyroCard);
        }

        /**
         * Renders the full data table.
         */
        function renderFullTable(data) { 
            tableHeaderRow.innerHTML = '';
            tableBody.innerHTML = '';
            noDataFoundDiv.classList.add('hidden');
            tableDataCount.textContent = data.length;

            if (data.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="100%" class="text-center py-8 text-gray-500">
                    <i class="fas fa-database text-4xl mb-4 text-gray-300"></i>
                    <p>${translations[currentLanguage].noDataFound}</p>
                </td></tr>`;
                noDataFoundDiv.classList.remove('hidden');
                return;
            }

            // Create table headers
            const headers = Object.keys(data[0]);
            const translatedHeaders = translations[currentLanguage].chartLabels;

            headers.forEach(header => {
                const th = document.createElement('th');
                th.className = 'px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider text-right';
                th.textContent = translatedHeaders[header] || header;
                tableHeaderRow.appendChild(th);
            });

            // Populate table body
            data.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.className = index % 2 === 0 ? 'bg-white hover:bg-blue-50' : 'bg-gray-50 hover:bg-blue-50';
                headers.forEach(header => {
                    const td = document.createElement('td');
                    td.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-900';
                    
                    let cellValue = row[header];
                    if (header === 'Date') {
                        cellValue = getFormattedDateForDisplay(cellValue, row['Heure']);
                    } else if (header === 'Heure') {
                        cellValue = getFormattedTimeForDisplay(row['Date'], cellValue);
                    } else if (chartMetrics.includes(header)) {
                        cellValue = formatNumericValue(cellValue);
                    }
                    td.textContent = cellValue;
                    tr.appendChild(td);
                });
                tableBody.appendChild(tr);
            });
        }

        /**
         * Renders charts for the specified metrics.
         */
        function renderCharts(data) {
            chartsContainer.innerHTML = '';
            chartDataCount.textContent = data.length;
            
            if (data.length === 0) {
                chartsContainer.innerHTML = `<div class="col-span-full text-center py-8 text-gray-500">
                    <i class="fas fa-database text-4xl mb-4 text-gray-300"></i>
                    <p>${translations[currentLanguage].noDataFound}</p>
                </div>`;
                return;
            }

            // Sort data by Timestamp
            const sortedData = [...data].sort((a, b) => {
                const dateA = new Date(`${a.Date}T${a.Heure}Z`);
                const dateB = new Date(`${b.Date}T${b.Heure}Z`);
                return dateA - dateB;
            });

            // Extract labels (timestamps)
            const labels = sortedData.map(entry => {
                const date = new Date(`${entry.Date}T${entry.Heure}Z`);
                if (date && !isNaN(date.getTime())) {
                    return date.toLocaleTimeString(currentLanguage, {
                        hour: '2-digit', minute: '2-digit', second: '2-digit',
                        hour12: false
                    });
                }
                return translations[currentLanguage].invalidDate + '/' + translations[currentLanguage].invalidTime;
            });

            chartMetrics.forEach((metric, index) => {
                // Determine color and point style based on index
                const color = chartColors[index % chartColors.length];
                const pointStyle = pointStyles[index % pointStyles.length];

                const chartDiv = document.createElement('div');
                chartDiv.className = 'glass-card p-4 rounded-xl';
                chartDiv.innerHTML = `
                    <div class="mb-3">
                        <h3 class="text-lg font-semibold text-gray-800">${translations[currentLanguage].chartLabels[metric] || metric}</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="chart-${metric.replace(/[^a-zA-Z0-9]/g, '-')}"></canvas>
                    </div>
                `;
                chartsContainer.appendChild(chartDiv);

                const ctx = document.getElementById(`chart-${metric.replace(/[^a-zA-Z0-9]/g, '-')}`).getContext('2d');
                const datasets = sortedData.map(entry => parseFloat(entry[metric]) || 0); 

                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: translations[currentLanguage].chartLabels[metric] || metric,
                            data: datasets,
                            borderColor: color,
                            backgroundColor: color.replace('rgb', 'rgba').replace(')', ', 0.1)'),
                            borderWidth: 2,
                            tension: 0.3,
                            pointRadius: 5,
                            pointBackgroundColor: color,
                            pointStyle: pointStyle,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    title: function(context) {
                                        return `${translations[currentLanguage].chartLabels['Timestamp']}: ${context[0].label}`;
                                    },
                                    label: function(context) {
                                        return `${translations[currentLanguage].chartLabels[metric] || metric}: ${context.raw.toLocaleString(currentLanguage)}`;
                                    }
                                },
                                rtl: (currentLanguage === 'ar')
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: translations[currentLanguage].chartLabels['Heure'],
                                    font: { size: 12, weight: 'bold' }
                                },
                                ticks: {
                                    autoSkip: true,
                                    maxTicksLimit: 10,
                                    font: { size: 10 }
                                }
                            },
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: translations[currentLanguage].chartLabels[metric] || metric,
                                    font: { size: 12, weight: 'bold' }
                                },
                                ticks: {
                                    font: { size: 10 },
                                    callback: function(value) {
                                        return value.toLocaleString(currentLanguage);
                                    }
                                }
                            }
                        },
                        indexAxis: 'x',
                        rtl: (currentLanguage === 'ar') 
                    }
                });
            });
        }

        /**
         * Updates all UI elements based on the selected language.
         */
        function updateUIForLanguage(lang) {
            currentLanguage = lang;
            const t = translations[currentLanguage];

            document.body.style.direction = (lang === 'ar') ? 'rtl' : 'ltr';
            document.body.style.textAlign = (lang === 'ar') ? 'right' : 'left';

            // Update texts
            dashboardTitle.textContent = t.dashboardTitle;
            document.title = t.dashboardTitle;

            // Navigation buttons
            latestDataBtn.querySelector('span').textContent = t.latestDataBtn;
            accelGyroBtn.querySelector('span').textContent = t.accelGyroBtn;
            fullTableBtn.querySelector('span').textContent = t.fullTableBtn;
            chartsBtn.querySelector('span').textContent = t.chartsBtn;

            // Other texts
            loadingText.textContent = t.loadingText;
            errorTitle.textContent = t.errorTitle;
            errorTextSpan.textContent = t.errorText;
            latestDataTitle.textContent = t.latestDataTitle;
            accelGyroTitle.textContent = t.accelGyroTitle;
            fullTableTitle.textContent = t.fullTableTitle;
            chartsTitle.textContent = t.chartsTitle;
            fromDateLabel.textContent = t.fromDateLabel;
            toDateLabel.textContent = t.toDateLabel;
            fromTimeLabel.textContent = t.fromTimeLabel;
            toTimeLabel.textContent = t.toTimeLabel;
            applyFiltersBtn.querySelector('span').textContent = t.applyFiltersBtn;
            resetFiltersBtn.querySelector('span').textContent = t.resetFiltersBtn;
            manualRefreshBtn.querySelector('span').textContent = t.manualRefresh;
            tableDataCount.nextSibling.textContent = t.records;
            chartDataCount.nextSibling.textContent = t.dataPoints;
            autoRefreshToggleBtn.querySelector('span').textContent = autoRefreshIntervalId ? 
                t.autoRefreshOn : t.autoRefreshOff;
            generateInsightBtn.querySelector('span').textContent = t.generateInsightBtn;
            insightCardTitle.textContent = t.insightCardTitle;
            insightLoadingText.textContent = t.generatingInsight;

            // Re-render data
            renderLatestData(sensorData);
            renderAccelGyroData(sensorData);
            renderFullTable(sensorData);

            // Update current date/time display
            updateCurrentDateTimeDisplay();
        }

        /**
         * Toggles the auto-refresh functionality.
         */
        function toggleAutoRefresh() {
            const t = translations[currentLanguage];
            
            if (autoRefreshIntervalId) {
                // Stop auto-refresh
                clearInterval(autoRefreshIntervalId);
                autoRefreshIntervalId = null;
                autoRefreshToggleBtn.querySelector('span').textContent = t.autoRefreshOff;
                autoRefreshToggleBtn.classList.remove('bg-green-500', 'pulse');
                autoRefreshToggleBtn.classList.add('bg-gray-600');
            } else {
                // Start auto-refresh (every 30 seconds)
                autoRefreshIntervalId = setInterval(() => {
                    fetchData();
                }, 30000);
                autoRefreshToggleBtn.querySelector('span').textContent = t.autoRefreshOn;
                autoRefreshToggleBtn.classList.remove('bg-gray-600');
                autoRefreshToggleBtn.classList.add('bg-green-500', 'pulse');
                fetchData(); // Fetch data immediately when starting
            }
        }

        /**
         * Generates an insight from the latest sensor data.
         */
        function generateInsight() {
            if (sensorData.length === 0) {
                insightCard.classList.remove('hidden');
                insightContent.textContent = translations[currentLanguage].noDataForInsight;
                return;
            }

            insightContent.textContent = '';
            insightLoading.classList.remove('hidden');
            insightCard.classList.remove('hidden');
            generateInsightBtn.disabled = true;
            generateInsightBtn.classList.add('opacity-50', 'cursor-not-allowed');

            // Simulate AI insight generation
            setTimeout(() => {
                const latestEntry = sensorData[sensorData.length - 1];
                const temperature = parseFloat(latestEntry['TempÃ©rature (Â°C)']);
                const humidity = parseFloat(latestEntry['HumiditÃ© (%)']);
                
                let insightText = "";
                
                if (currentLanguage === 'ar') {
                    insightText = `ØªØ´ÙŠØ± Ø£Ø­Ø¯Ø« Ù‚Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø³ØªØ´Ø¹Ø± Ø¥Ù„Ù‰ Ø§Ø³ØªÙ‚Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø¸Ø±ÙˆÙ Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©. Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ${temperature}Â°C ÙˆØ§Ù„Ø±Ø·ÙˆØ¨Ø© ${humidity}% ÙˆÙ‡Ù…Ø§ Ø¶Ù…Ù† Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ.`;
                    
                    if (temperature > 28) {
                        insightText += " Ù„Ø§Ø­Ø¸Ù†Ø§ Ø§Ø±ØªÙØ§Ø¹Ø§Ù‹ Ø·ÙÙŠÙØ§Ù‹ ÙÙŠ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©ØŒ Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªØ¨Ø±ÙŠØ¯.";
                    }
                    
                    insightText += " Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¤Ø´Ø±Ø§Øª Ø¹Ù„Ù‰ ÙˆØ¬ÙˆØ¯ Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…. Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¸Ø±ÙˆÙ Ø§Ù„Ù…Ø«Ù„Ù‰.";
                } else if (currentLanguage === 'en') {
                    insightText = `The latest sensor readings indicate stable environmental conditions. The current temperature is ${temperature}Â°C and humidity is ${humidity}%, both within normal range.`;
                    
                    if (temperature > 28) {
                        insightText += " We've noticed a slight increase in temperature, you may need to monitor cooling.";
                    }
                    
                    insightText += " There are no indicators of system issues. Continue monitoring to maintain optimal conditions.";
                } else {
                    insightText = `Les derniÃ¨res lectures des capteurs indiquent des conditions environnementales stables. La tempÃ©rature actuelle est de ${temperature}Â°C et l'humiditÃ© est de ${humidity}%, toutes deux dans la plage normale.`;
                    
                    if (temperature > 28) {
                        insightText += " Nous avons remarquÃ© une lÃ©gÃ¨re augmentation de la tempÃ©rature, vous devrez peut-Ãªtre surveiller le refroidissement.";
                    }
                    
                    insightText += " Il n'y a aucun indicateur de problÃ¨mes systÃ¨me. Continuez Ã  surveiller pour maintenir des conditions optimales.";
                }
                
                insightContent.textContent = insightText;
                insightLoading.classList.add('hidden');
                generateInsightBtn.disabled = false;
                generateInsightBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }, 2000);
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            fetchData();
            showPage('latestData');
            updateUIForLanguage(currentLanguage);
            toggleAutoRefresh();
            setInterval(updateCurrentDateTimeDisplay, 1000);

            // Navigation buttons
            document.querySelectorAll('.nav-button').forEach(button => {
                button.addEventListener('click', (event) => {
                    const targetPage = event.currentTarget.dataset.target;
                    showPage(targetPage);
                });
            });

            // Language switcher
            document.querySelectorAll('.lang-button').forEach(button => {
                button.addEventListener('click', (event) => {
                    const lang = event.currentTarget.dataset.lang;
                    updateUIForLanguage(lang);
                });
            });

            // Auto-refresh toggle
            autoRefreshToggleBtn.addEventListener('click', toggleAutoRefresh);
            
            // Manual refresh
            manualRefreshBtn.addEventListener('click', () => {
                fetchData();
            });
            
            // Generate insight
            generateInsightBtn.addEventListener('click', generateInsight);
        });

    </script>
</body>
</html>
