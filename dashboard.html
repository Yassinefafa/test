<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interface de Surveillance IoT</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f2f2f2; }
    header { background: #2c3e50; color: white; padding: 1em; text-align: center; }
    nav { display: flex; justify-content: center; background: #34495e; flex-wrap: wrap; }
    nav a {
      padding: 1em;
      color: white;
      text-decoration: none;
      transition: background 0.3s;
    }
    nav a:hover {
      background: #1abc9c;
    }
    section { padding: 2em; display: none; }
    section.active { display: block; }
    iframe { width: 100%; height: 500px; border: none; }
    #logoutBtn { display: none; margin: 1em; background: #e74c3c; color: white; border: none; padding: 0.5em 1em; cursor: pointer; }
    #logoutBtn:hover { background: #c0392b; }
    #login { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
    #login input { padding: 0.5em; margin: 0.5em; }
    #login button { padding: 0.5em 1em; background: #3498db; color: white; border: none; cursor: pointer; }
    #login button:hover { background: #2980b9; }
    table { width: 100%; border-collapse: collapse; margin-top: 1em; }
    th, td { border: 1px solid #ccc; padding: 0.5em; text-align: center; }
    th { background-color: #ddd; }
    input[type='password'] {
      font-family: monospace;
    }
  </style>
</head>
<body>
  <div id="login">
    <h2>Connexion</h2>
    <input type="text" id="username" placeholder="Nom d'utilisateur">
    <input type="password" id="password" placeholder="Mot de passe">
    <button onclick="login()">Se connecter</button>
  </div>

  <div id="app" style="display:none">
    <header>
      <h1>Tableau de bord - Monitoring IoT</h1>
      <button id="logoutBtn" onclick="logout()">Déconnexion</button>
    </header>

    <nav>
      <a href="#" onclick="showPage('home')">Accueil</a>
      <a href="#" onclick="showPage('temperature')">Température</a>
      <a href="#" onclick="showPage('humidite')">Humidité</a>
      <a href="#" onclick="showPage('vibration')">Vibration</a>
      <a href="#" onclick="showPage('accelero')">Accéléromètre/Gyroscope</a>
      <a href="#" onclick="showPage('admin')">Gestion Utilisateurs</a>
    </nav>

    <section id="home" class="active">
      <h2>Bienvenue</h2>
      <p>Sélectionnez une section dans le menu pour visualiser les données en temps réel.</p>
    </section>

    <section id="temperature">
      <h2>Graphique - Température</h2>
      <iframe src="https://lookerstudio.google.com/embed/reporting/45b373f1-4741-4fe0-a840-df2e08e19334/page/page_12345" allowfullscreen></iframe>
    </section>

    <section id="humidite">
      <h2>Graphique - Humidité</h2>
      <iframe src="https://datastudio.google.com/embed/reporting/YOUR_HUMIDITY_REPORT_ID/page/1" allowfullscreen></iframe>
    </section>

    <section id="vibration">
      <h2>Graphique - Vibration</h2>
      <iframe src="https://datastudio.google.com/embed/reporting/YOUR_VIBRATION_REPORT_ID/page/1" allowfullscreen></iframe>
    </section>

    <section id="accelero">
      <h2>Graphique - Accéléromètre / Gyroscope</h2>
      <iframe src="https://lookerstudio.google.com/embed/reporting/5ec21a08-6ec2-472a-9d1e-148dfa382f19/page/page_12345" allowfullscreen></iframe>
    </section>

    <section id="admin">
      <h2>Gestion des utilisateurs</h2>
      <label>Changer le mot de passe :</label>
      <input type="password" id="newPassword" placeholder="Nouveau mot de passe">
      <button onclick="changePassword()">Modifier</button>
      <br><br>
      <label>Ajouter un utilisateur :</label>
      <input type="text" id="newUser" placeholder="Nom d'utilisateur">
      <input type="password" id="userPassword" placeholder="Mot de passe">
      <button onclick="addUser()">Ajouter</button>
      <br><br>
      <h3>Liste des utilisateurs</h3>
      <table>
        <thead><tr><th>Nom d'utilisateur</th><th>Mot de passe</th><th>Action</th></tr></thead>
        <tbody id="userTable"></tbody>
      </table>
    </section>
  </div>

  <script>
    let users = JSON.parse(localStorage.getItem('users')) || { "admin": "iot2025" };
    let currentUser = null;

    function saveUsers() {
      localStorage.setItem('users', JSON.stringify(users));
    }

    function login() {
      const username = document.getElementById('username').value;
      const pwd = document.getElementById('password').value;
      if (users[username] && users[username] === pwd) {
        currentUser = username;
        document.getElementById('login').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        document.getElementById('logoutBtn').style.display = 'inline-block';
        updateUserTable();
      } else {
        alert("Nom d'utilisateur ou mot de passe incorrect");
      }
    }

    function logout() {
      currentUser = null;
      document.getElementById('login').style.display = 'flex';
      document.getElementById('app').style.display = 'none';
      document.getElementById('password').value = "";
      document.getElementById('username').value = "";
    }

    function showPage(id) {
      document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function changePassword() {
      const newPwd = document.getElementById('newPassword').value;
      if (currentUser && newPwd) {
        users[currentUser] = newPwd;
        saveUsers();
        alert("Mot de passe mis à jour pour " + currentUser);
        updateUserTable();
      } else {
        alert("Erreur : veuillez entrer un nouveau mot de passe.");
      }
    }

    function addUser() {
      const user = document.getElementById('newUser').value;
      const pass = document.getElementById('userPassword').value;
      if (user && pass) {
        users[user] = pass;
        saveUsers();
        alert("Nouvel utilisateur ajouté : " + user);
        updateUserTable();
      } else {
        alert("Veuillez saisir un nom d'utilisateur et un mot de passe.");
      }
    }

    function updateUserTable() {
      const table = document.getElementById('userTable');
      table.innerHTML = '';
      for (let user in users) {
        table.innerHTML += `<tr><td>${user}</td><td><input type="password" value="${users[user]}" disabled></td><td><button onclick="editUserPassword('${user}')">Modifier</button></td></tr>`;
      }
    }

    function editUserPassword(user) {
      const newPass = prompt("Entrez le nouveau mot de passe pour " + user);
      if (newPass) {
        users[user] = newPass;
        saveUsers();
        alert("Mot de passe mis à jour pour " + user);
        updateUserTable();
      }
    }
  </script>
</body>
</html>
