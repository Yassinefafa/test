<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Visualisation des DonnÃ©es Capteurs</title>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
    google.charts.load('current', { packages: ['corechart', 'controls'] });
    google.charts.setOnLoadCallback(drawDashboard);

    function drawDashboard() {
      const query = new google.visualization.Query(
        'https://docs.google.com/spreadsheets/d/1tqB-t3cDJiDhAHsgSGWJw7p4-pnE8pHHqubPHIStZ8c/gviz/tq?sheet=DATA'
      );

      query.send(function (response) {
        if (response.isError()) {
          alert('Erreur de chargement : ' + response.getMessage());
          return;
        }

        const data = response.getDataTable();

        // Conversion de la colonne Date + Heure en objet Date JS (colonne 0 + 1)
        for (let i = 0; i < data.getNumberOfRows(); i++) {
          const dateStr = data.getValue(i, 0); // Date
          const timeStr = data.getValue(i, 1); // Time

          const dateTime = new Date(dateStr + 'T' + timeStr);
          data.setValue(i, 0, dateTime); // remplace la colonne 0
        }

        // Supprimer la colonne 1 (Time) car on lâ€™a fusionnÃ©e
        data.removeColumn(1);

        const dashboard = new google.visualization.Dashboard(
          document.getElementById('dashboard_div')
        );

        const dateSlider = new google.visualization.ControlWrapper({
          controlType: 'ChartRangeFilter',
          containerId: 'filter_div',
          options: {
            filterColumnIndex: 0,
            ui: {
              chartType: 'LineChart',
              chartOptions: {
                title: 'PÃ©riode',
                height: 100,
              },
            },
          },
        });

        const chart = new google.visualization.ChartWrapper({
          chartType: 'LineChart',
          containerId: 'chart_div',
          options: {
            title: 'TempÃ©rature et HumiditÃ©',
            curveType: 'function',
            legend: { position: 'bottom' },
            height: 400,
          },
          view: {
            columns: [0, 1, 2], // DateTime, TempÃ©rature, HumiditÃ©
          },
        });

        dashboard.bind(dateSlider, chart);
        dashboard.draw(data);
      });
    }
  </script>
</head>
<body style="font-family: Arial; margin: 40px; background: #f9f9f9;">
  <h2>ðŸŒ‰ Visualisation des DonnÃ©es Capteurs</h2>
  <div id="dashboard_div">
    <div id="filter_div"></div>
    <div id="chart_div"></div>
  </div>
</body>
</html>
